{% extends 'base.html' %}

{% block title %}Personality Assessment - NOOR{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-900 text-white" x-data="personalityAssessment()">
    <!-- Header -->
    <header class="bg-gray-800/50 backdrop-blur-lg border-b border-gray-700/50 sticky top-0 z-40">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-bold neon-text">Personality Assessment</h1>
                    <span class="text-gray-400">Discover Your Inner Self</span>
                </div>
                <a href="{% url 'personality:dashboard' %}" class="btn-secondary">View Dashboard</a>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8">
        <!-- Introduction -->
        <div class="glass rounded-2xl p-8 mb-8 text-center">
            <div class="text-6xl mb-4">🧠</div>
            <h2 class="text-3xl font-bold mb-4">NOOR Personality Assessment</h2>
            <p class="text-gray-300 text-lg mb-6">
                Help NOOR understand you better by completing this personality assessment. 
                Your responses will help me adapt my communication style and provide personalized recommendations.
            </p>
            {% if has_previous_assessment %}
                <div class="bg-blue-500/20 border border-blue-500/30 rounded-lg p-4 mb-4">
                    <p class="text-blue-300">You've completed a previous assessment. This new assessment will help track your personality evolution over time.</p>
                </div>
            {% endif %}
        </div>

        <!-- Assessment Form -->
        <div class="glass rounded-2xl p-8">
            <form @submit.prevent="submitAssessment()" x-show="!showResults">
                <div class="space-y-8">
                    <!-- Openness Section -->
                    <div class="assessment-section">
                        <h3 class="text-xl font-semibold mb-4 text-purple-300">🎨 Openness to Experience</h3>
                        <p class="text-gray-400 mb-4">How much do you enjoy new experiences and creative thinking?</p>
                        
                        <div class="space-y-4">
                            <div class="question-item">
                                <label class="block text-sm font-medium mb-2">I enjoy exploring new ideas and concepts</label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-gray-400">Strongly Disagree</span>
                                    <input type="range" x-model="responses.openness1" min="1" max="5" step="1" class="flex-1">
                                    <span class="text-sm text-gray-400">Strongly Agree</span>
                                    <span class="text-sm font-medium w-8" x-text="responses.openness1"></span>
                                </div>
                            </div>
                            
                            <div class="question-item">
                                <label class="block text-sm font-medium mb-2">I prefer routine and familiar activities</label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-gray-400">Strongly Disagree</span>
                                    <input type="range" x-model="responses.openness2" min="1" max="5" step="1" class="flex-1">
                                    <span class="text-sm text-gray-400">Strongly Agree</span>
                                    <span class="text-sm font-medium w-8" x-text="responses.openness2"></span>
                                </div>
                            </div>
                            
                            <div class="question-item">
                                <label class="block text-sm font-medium mb-2">I enjoy artistic and creative activities</label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-gray-400">Strongly Disagree</span>
                                    <input type="range" x-model="responses.openness3" min="1" max="5" step="1" class="flex-1">
                                    <span class="text-sm text-gray-400">Strongly Agree</span>
                                    <span class="text-sm font-medium w-8" x-text="responses.openness3"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Conscientiousness Section -->
                    <div class="assessment-section">
                        <h3 class="text-xl font-semibold mb-4 text-blue-300">📋 Conscientiousness</h3>
                        <p class="text-gray-400 mb-4">How organized and disciplined are you?</p>
                        
                        <div class="space-y-4">
                            <div class="question-item">
                                <label class="block text-sm font-medium mb-2">I keep my commitments and deadlines</label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-gray-400">Strongly Disagree</span>
                                    <input type="range" x-model="responses.conscientiousness1" min="1" max="5" step="1" class="flex-1">
                                    <span class="text-sm text-gray-400">Strongly Agree</span>
                                    <span class="text-sm font-medium w-8" x-text="responses.conscientiousness1"></span>
                                </div>
                            </div>
                            
                            <div class="question-item">
                                <label class="block text-sm font-medium mb-2">I am organized and neat</label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-gray-400">Strongly Disagree</span>
                                    <input type="range" x-model="responses.conscientiousness2" min="1" max="5" step="1" class="flex-1">
                                    <span class="text-sm text-gray-400">Strongly Agree</span>
                                    <span class="text-sm font-medium w-8" x-text="responses.conscientiousness2"></span>
                                </div>
                            </div>
                            
                            <div class="question-item">
                                <label class="block text-sm font-medium mb-2">I often procrastinate on important tasks</label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-gray-400">Strongly Disagree</span>
                                    <input type="range" x-model="responses.conscientiousness3" min="1" max="5" step="1" class="flex-1">
                                    <span class="text-sm text-gray-400">Strongly Agree</span>
                                    <span class="text-sm font-medium w-8" x-text="responses.conscientiousness3"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Extraversion Section -->
                    <div class="assessment-section">
                        <h3 class="text-xl font-semibold mb-4 text-green-300">👥 Extraversion</h3>
                        <p class="text-gray-400 mb-4">How social and energetic are you?</p>
                        
                        <div class="space-y-4">
                            <div class="question-item">
                                <label class="block text-sm font-medium mb-2">I enjoy being the center of attention</label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-gray-400">Strongly Disagree</span>
                                    <input type="range" x-model="responses.extraversion1" min="1" max="5" step="1" class="flex-1">
                                    <span class="text-sm text-gray-400">Strongly Agree</span>
                                    <span class="text-sm font-medium w-8" x-text="responses.extraversion1"></span>
                                </div>
                            </div>
                            
                            <div class="question-item">
                                <label class="block text-sm font-medium mb-2">I feel energized by social interactions</label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-gray-400">Strongly Disagree</span>
                                    <input type="range" x-model="responses.extraversion2" min="1" max="5" step="1" class="flex-1">
                                    <span class="text-sm text-gray-400">Strongly Agree</span>
                                    <span class="text-sm font-medium w-8" x-text="responses.extraversion2"></span>
                                </div>
                            </div>
                            
                            <div class="question-item">
                                <label class="block text-sm font-medium mb-2">I prefer quiet, solitary activities</label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-gray-400">Strongly Disagree</span>
                                    <input type="range" x-model="responses.extraversion3" min="1" max="5" step="1" class="flex-1">
                                    <span class="text-sm text-gray-400">Strongly Agree</span>
                                    <span class="text-sm font-medium w-8" x-text="responses.extraversion3"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Agreeableness Section -->
                    <div class="assessment-section">
                        <h3 class="text-xl font-semibold mb-4 text-yellow-300">🤝 Agreeableness</h3>
                        <p class="text-gray-400 mb-4">How cooperative and trusting are you?</p>
                        
                        <div class="space-y-4">
                            <div class="question-item">
                                <label class="block text-sm font-medium mb-2">I try to help others when possible</label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-gray-400">Strongly Disagree</span>
                                    <input type="range" x-model="responses.agreeableness1" min="1" max="5" step="1" class="flex-1">
                                    <span class="text-sm text-gray-400">Strongly Agree</span>
                                    <span class="text-sm font-medium w-8" x-text="responses.agreeableness1"></span>
                                </div>
                            </div>
                            
                            <div class="question-item">
                                <label class="block text-sm font-medium mb-2">I trust people easily</label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-gray-400">Strongly Disagree</span>
                                    <input type="range" x-model="responses.agreeableness2" min="1" max="5" step="1" class="flex-1">
                                    <span class="text-sm text-gray-400">Strongly Agree</span>
                                    <span class="text-sm font-medium w-8" x-text="responses.agreeableness2"></span>
                                </div>
                            </div>
                            
                            <div class="question-item">
                                <label class="block text-sm font-medium mb-2">I often put my needs before others'</label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-gray-400">Strongly Disagree</span>
                                    <input type="range" x-model="responses.agreeableness3" min="1" max="5" step="1" class="flex-1">
                                    <span class="text-sm text-gray-400">Strongly Agree</span>
                                    <span class="text-sm font-medium w-8" x-text="responses.agreeableness3"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Neuroticism Section -->
                    <div class="assessment-section">
                        <h3 class="text-xl font-semibold mb-4 text-red-300">🧘 Emotional Stability</h3>
                        <p class="text-gray-400 mb-4">How do you handle stress and emotions?</p>
                        
                        <div class="space-y-4">
                            <div class="question-item">
                                <label class="block text-sm font-medium mb-2">I worry about things frequently</label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-gray-400">Strongly Disagree</span>
                                    <input type="range" x-model="responses.neuroticism1" min="1" max="5" step="1" class="flex-1">
                                    <span class="text-sm text-gray-400">Strongly Agree</span>
                                    <span class="text-sm font-medium w-8" x-text="responses.neuroticism1"></span>
                                </div>
                            </div>
                            
                            <div class="question-item">
                                <label class="block text-sm font-medium mb-2">I remain calm under pressure</label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-gray-400">Strongly Disagree</span>
                                    <input type="range" x-model="responses.neuroticism2" min="1" max="5" step="1" class="flex-1">
                                    <span class="text-sm text-gray-400">Strongly Agree</span>
                                    <span class="text-sm font-medium w-8" x-text="responses.neuroticism2"></span>
                                </div>
                            </div>
                            
                            <div class="question-item">
                                <label class="block text-sm font-medium mb-2">My emotions change quickly</label>
                                <div class="flex items-center space-x-4">
                                    <span class="text-sm text-gray-400">Strongly Disagree</span>
                                    <input type="range" x-model="responses.neuroticism3" min="1" max="5" step="1" class="flex-1">
                                    <span class="text-sm text-gray-400">Strongly Agree</span>
                                    <span class="text-sm font-medium w-8" x-text="responses.neuroticism3"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="mt-8 text-center">
                    <button type="submit" 
                            :disabled="isSubmitting"
                            class="btn-primary text-lg px-8 py-3"
                            x-bind:class="{ 'opacity-50 cursor-not-allowed': isSubmitting }">
                        <span x-show="!isSubmitting">Complete Assessment</span>
                        <span x-show="isSubmitting">Processing...</span>
                    </button>
                </div>
            </form>

            <!-- Results -->
            <div x-show="showResults" x-transition class="text-center">
                <div class="text-6xl mb-4">🎉</div>
                <h2 class="text-3xl font-bold mb-4">Assessment Complete!</h2>
                <p class="text-gray-300 text-lg mb-6">
                    Thank you for completing the personality assessment. NOOR now has a better understanding of your personality.
                </p>
                
                <!-- Personality Results -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
                    <div class="glass-dark rounded-lg p-4">
                        <h4 class="font-semibold text-purple-300">Openness</h4>
                        <div class="text-2xl font-bold" x-text="Math.round(personalityScores.openness * 100) + '%'"></div>
                    </div>
                    <div class="glass-dark rounded-lg p-4">
                        <h4 class="font-semibold text-blue-300">Conscientiousness</h4>
                        <div class="text-2xl font-bold" x-text="Math.round(personalityScores.conscientiousness * 100) + '%'"></div>
                    </div>
                    <div class="glass-dark rounded-lg p-4">
                        <h4 class="font-semibold text-green-300">Extraversion</h4>
                        <div class="text-2xl font-bold" x-text="Math.round(personalityScores.extraversion * 100) + '%'"></div>
                    </div>
                    <div class="glass-dark rounded-lg p-4">
                        <h4 class="font-semibold text-yellow-300">Agreeableness</h4>
                        <div class="text-2xl font-bold" x-text="Math.round(personalityScores.agreeableness * 100) + '%'"></div>
                    </div>
                    <div class="glass-dark rounded-lg p-4">
                        <h4 class="font-semibold text-red-300">Emotional Stability</h4>
                        <div class="text-2xl font-bold" x-text="Math.round((1 - personalityScores.neuroticism) * 100) + '%'"></div>
                    </div>
                </div>

                <div class="space-y-4">
                    <a href="{% url 'personality:dashboard' %}" class="btn-primary mr-4">View Dashboard</a>
                    <a href="{% url 'home' %}" class="btn-secondary">Back to NOOR</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function personalityAssessment() {
    return {
        responses: {
            openness1: 3,
            openness2: 3,
            openness3: 3,
            conscientiousness1: 3,
            conscientiousness2: 3,
            conscientiousness3: 3,
            extraversion1: 3,
            extraversion2: 3,
            extraversion3: 3,
            agreeableness1: 3,
            agreeableness2: 3,
            agreeableness3: 3,
            neuroticism1: 3,
            neuroticism2: 3,
            neuroticism3: 3,
        },
        isSubmitting: false,
        showResults: false,
        personalityScores: {},
        
        calculateScores() {
            // Calculate Big Five scores from responses
            const openness = (
                parseInt(this.responses.openness1) + 
                (6 - parseInt(this.responses.openness2)) + // Reverse scored
                parseInt(this.responses.openness3)
            ) / 15;
            
            const conscientiousness = (
                parseInt(this.responses.conscientiousness1) + 
                parseInt(this.responses.conscientiousness2) + 
                (6 - parseInt(this.responses.conscientiousness3)) // Reverse scored
            ) / 15;
            
            const extraversion = (
                parseInt(this.responses.extraversion1) + 
                parseInt(this.responses.extraversion2) + 
                (6 - parseInt(this.responses.extraversion3)) // Reverse scored
            ) / 15;
            
            const agreeableness = (
                parseInt(this.responses.agreeableness1) + 
                parseInt(this.responses.agreeableness2) + 
                (6 - parseInt(this.responses.agreeableness3)) // Reverse scored
            ) / 15;
            
            const neuroticism = (
                parseInt(this.responses.neuroticism1) + 
                (6 - parseInt(this.responses.neuroticism2)) + // Reverse scored
                parseInt(this.responses.neuroticism3)
            ) / 15;
            
            return {
                openness: Math.max(0, Math.min(1, openness)),
                conscientiousness: Math.max(0, Math.min(1, conscientiousness)),
                extraversion: Math.max(0, Math.min(1, extraversion)),
                agreeableness: Math.max(0, Math.min(1, agreeableness)),
                neuroticism: Math.max(0, Math.min(1, neuroticism)),
            };
        },
        
        async submitAssessment() {
            this.isSubmitting = true;
            
            try {
                const scores = this.calculateScores();
                this.personalityScores = scores;
                
                const response = await fetch('{% url "personality:api_assessment" %}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}',
                    },
                    body: JSON.stringify({
                        assessment_type: 'survey',
                        ...scores,
                        confidence_scores: {
                            openness: 0.8,
                            conscientiousness: 0.8,
                            extraversion: 0.8,
                            agreeableness: 0.8,
                            neuroticism: 0.8,
                        }
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    this.showResults = true;
                } else {
                    alert('Error submitting assessment: ' + data.error);
                }
                
            } catch (error) {
                console.error('Error submitting assessment:', error);
                alert('Error submitting assessment. Please try again.');
            }
            
            this.isSubmitting = false;
        }
    };
}
</script>

<style>
.assessment-section {
    @apply bg-gray-800/30 rounded-lg p-6 border border-gray-700/30;
}

.question-item {
    @apply bg-gray-800/50 rounded-lg p-4;
}

input[type="range"] {
    @apply appearance-none bg-gray-700 h-2 rounded-lg outline-none;
}

input[type="range"]::-webkit-slider-thumb {
    @apply appearance-none w-5 h-5 bg-purple-500 rounded-full cursor-pointer hover:bg-purple-400 transition-colors;
}

input[type="range"]::-moz-range-thumb {
    @apply w-5 h-5 bg-purple-500 rounded-full cursor-pointer border-none hover:bg-purple-400 transition-colors;
}
</style>
{% endblock %}
