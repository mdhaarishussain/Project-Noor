{% extends 'base.html' %}

{% block title %}NOOR - Your AI Companion{% endblock %}

{% block content %}
<div class="min-h-screen w-full" x-data="noorApp()">
    <!-- Desktop Header -->
    <header class="bg-gray-900/90 backdrop-blur-lg border-b border-gray-700/50 fixed top-0 left-0 right-0 z-40">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <h1 class="text-3xl font-bold neon-text">NOOR</h1>
                    <span class="text-gray-400">Your Adaptive AI Companion</span>
                </div>
                <div class="flex items-center space-x-4">
                    <button @click="openChat()" class="btn-primary">💬 Chat</button>
                    <button @click="showNotifications = true" class="btn-secondary">🔔</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Area with Sidebar -->
    <div class="flex min-h-screen">
        <!-- Left Sidebar - NOOR Character & Quick Actions -->
        <aside class="w-80 bg-gray-900/30 backdrop-blur-lg border-r border-gray-700/50 fixed left-0 top-20 bottom-0 overflow-y-auto">
            <div class="p-6 space-y-6 pb-32">
                <!-- NOOR Character Section -->
                <div class="text-center">
                    <div class="relative inline-block">
                        <div class="w-32 h-32 mx-auto mb-4 relative">
                            <div class="absolute inset-0 rounded-full bg-gradient-to-r from-purple-500 to-blue-500 animate-pulse"></div>
                            <button @click="interactWithNoor()" 
                                    class="relative w-full h-full rounded-full bg-gray-800 border-4 border-gray-600 hover:border-purple-400 transition-all duration-300 text-6xl flex items-center justify-center transform hover:scale-105"
                                    x-bind:class="{ 'animate-bounce': isNoorTalking }">
                                <span x-text="noorExpression"></span>
                            </button>
                        </div>
                        <!-- Speech Bubble -->
                        <div x-show="noorMessage" 
                             x-transition:enter="transition ease-out duration-300"
                             x-transition:enter-start="opacity-0 scale-95"
                             x-transition:enter-end="opacity-100 scale-100"
                             class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-white text-gray-800 px-4 py-2 rounded-xl shadow-lg min-w-48 z-10">
                            <p x-text="noorMessage" class="text-sm font-medium"></p>
                            <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full">
                                <div class="w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-white"></div>
                            </div>
                        </div>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Hello! I'm NOOR</h3>
                    <p class="text-gray-400 text-sm">Click me to say hi!</p>
                </div>

                <!-- Quick Actions -->
                <div class="space-y-3">
                    <h4 class="text-lg font-semibold">Quick Actions</h4>
                    <button @click="openChat()" class="w-full btn-primary text-left">💬 Start Conversation</button>
                    <button @click="showMediaSuggestions = true" class="w-full btn-secondary text-left">🎵 Get Media Suggestions</button>
                    <button @click="showGames = true" class="w-full btn-secondary text-left">🎮 Play RPG Games</button>
                    <button @click="showMoodCheck = true" class="w-full btn-secondary text-left">😊 Mood Check-in</button>
                </div>

                <!-- Status Indicators -->
                <div class="space-y-3">
                    <h4 class="text-lg font-semibold">Your Status</h4>
                    <div class="glass-dark rounded-lg p-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm">Mood</span>
                            <span class="text-green-400 text-sm" x-text="userMood"></span>
                        </div>
                    </div>
                    <div class="glass-dark rounded-lg p-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm">Today's Progress</span>
                            <span class="text-blue-400 text-sm">75%</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="fixed top-20 right-0 bottom-0 left-80 overflow-y-auto">
            <div class="container mx-auto px-6 py-8 pb-40">
                
                <!-- Dashboard Cards Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6 mb-8">
                    
                    <!-- Media Suggestions Card -->
                    <div class="lg:col-span-1 xl:col-span-1">
                        <div class="glass rounded-2xl p-6 h-full">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-xl font-semibold">🎵 Media for You</h2>
                                <div class="flex space-x-2">
                                    <button @click="mediaTab = 'music'" 
                                            x-bind:class="{ 'bg-purple-600': mediaTab === 'music', 'bg-gray-700': mediaTab !== 'music' }"
                                            class="px-3 py-1 rounded-lg text-sm">Music</button>
                                    <button @click="mediaTab = 'videos'" 
                                            x-bind:class="{ 'bg-purple-600': mediaTab === 'videos', 'bg-gray-700': mediaTab !== 'videos' }"
                                            class="px-3 py-1 rounded-lg text-sm">Videos</button>
                                </div>
                            </div>
                            
                            <!-- Music Suggestions -->
                            <div class="space-y-3 max-h-80 overflow-y-auto" x-show="mediaTab === 'music'">
                                <div class="media-card glass-dark rounded-lg p-3 cursor-pointer hover:neon-glow transition-all" 
                                     @click="playMedia('music', 'lofi-beats')">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg flex items-center justify-center text-lg">🎵</div>
                                        <div>
                                            <h3 class="font-medium">Lofi Study Beats</h3>
                                            <p class="text-xs text-gray-400">Perfect for focus</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="media-card glass-dark rounded-lg p-3 cursor-pointer hover:neon-glow transition-all"
                                     @click="playMedia('music', 'upbeat-vibes')">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-lg flex items-center justify-center text-lg">🎧</div>
                                        <div>
                                            <h3 class="font-medium">Upbeat Vibes</h3>
                                            <p class="text-xs text-gray-400">Boost your mood</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="media-card glass-dark rounded-lg p-3 cursor-pointer hover:neon-glow transition-all"
                                     @click="playMedia('music', 'chill-ambient')">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gradient-to-r from-green-500 to-blue-500 rounded-lg flex items-center justify-center text-lg">🌿</div>
                                        <div>
                                            <h3 class="font-medium">Chill Ambient</h3>
                                            <p class="text-xs text-gray-400">Relax and unwind</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Video Suggestions -->
                            <div class="space-y-3 max-h-80 overflow-y-auto" x-show="mediaTab === 'videos'">
                                <div class="media-card glass-dark rounded-lg p-3 cursor-pointer hover:neon-glow transition-all"
                                     @click="playMedia('video', 'mindfulness')">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gradient-to-r from-orange-500 to-red-500 rounded-lg flex items-center justify-center text-lg">🧘</div>
                                        <div>
                                            <h3 class="font-medium">Mindfulness Session</h3>
                                            <p class="text-xs text-gray-400">5-min guided meditation</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="media-card glass-dark rounded-lg p-3 cursor-pointer hover:neon-glow transition-all"
                                     @click="playMedia('video', 'motivation')">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-lg flex items-center justify-center text-lg">⚡</div>
                                        <div>
                                            <h3 class="font-medium">Daily Motivation</h3>
                                            <p class="text-xs text-gray-400">Inspiring content</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- RPG Games Card -->
                    <div class="lg:col-span-1 xl:col-span-2">
                        <div class="glass rounded-2xl p-6 h-full">
                            <h2 class="text-xl font-semibold mb-4">🎮 Interactive RPG Games</h2>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 max-h-80 overflow-y-auto">
                                <div class="game-card glass-dark rounded-lg p-4 cursor-pointer hover:neon-glow transition-all"
                                     @click="selectGame('personality-quest')">
                                    <div class="text-center">
                                        <div class="text-3xl mb-2">🏰</div>
                                        <h3 class="font-semibold mb-1">Personality Quest</h3>
                                        <p class="text-xs text-gray-400 mb-2">Discover your traits</p>
                                        <div class="w-full bg-gray-700 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-purple-500 to-blue-500 h-2 rounded-full" style="width: 30%"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="game-card glass-dark rounded-lg p-4 cursor-pointer hover:neon-glow transition-all"
                                     @click="selectGame('mood-dungeon')">
                                    <div class="text-center">
                                        <div class="text-3xl mb-2">🌟</div>
                                        <h3 class="font-semibold mb-1">Mood Dungeon</h3>
                                        <p class="text-xs text-gray-400 mb-2">Battle negative thoughts</p>
                                        <div class="w-full bg-gray-700 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-green-500 to-blue-500 h-2 rounded-full" style="width: 60%"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="game-card glass-dark rounded-lg p-4 cursor-pointer hover:neon-glow transition-all"
                                     @click="selectGame('social-arena')">
                                    <div class="text-center">
                                        <div class="text-3xl mb-2">👥</div>
                                        <h3 class="font-semibold mb-1">Social Arena</h3>
                                        <p class="text-xs text-gray-400 mb-2">Practice conversations</p>
                                        <div class="w-full bg-gray-700 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-pink-500 to-purple-500 h-2 rounded-full" style="width: 45%"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="game-card glass-dark rounded-lg p-4 cursor-pointer hover:neon-glow transition-all"
                                     @click="selectGame('mindfulness-mystery')">
                                    <div class="text-center">
                                        <div class="text-3xl mb-2">🧘</div>
                                        <h3 class="font-semibold mb-1">Mindfulness Mystery</h3>
                                        <p class="text-xs text-gray-400 mb-2">Meditation puzzles</p>
                                        <div class="w-full bg-gray-700 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-cyan-500 to-green-500 h-2 rounded-full" style="width: 20%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Activity Feed & Recent Interactions -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Recent Activity -->
                    <div class="glass rounded-2xl p-6">
                        <h2 class="text-xl font-semibold mb-4">📊 Recent Activity</h2>
                        <div class="space-y-4 max-h-60 overflow-y-auto">
                            <div class="flex items-center space-x-3 p-3 glass-dark rounded-lg">
                                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-sm">✓</div>
                                <div>
                                    <p class="text-sm font-medium">Completed Mood Check-in</p>
                                    <p class="text-xs text-gray-400">2 hours ago</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3 p-3 glass-dark rounded-lg">
                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-sm">🎵</div>
                                <div>
                                    <p class="text-sm font-medium">Listened to Lofi Beats</p>
                                    <p class="text-xs text-gray-400">4 hours ago</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3 p-3 glass-dark rounded-lg">
                                <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-sm">🎮</div>
                                <div>
                                    <p class="text-sm font-medium">Started Personality Quest</p>
                                    <p class="text-xs text-gray-400">Yesterday</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Personality & Insights -->
                    <div class="glass rounded-2xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-semibold">🧠 Personality & Insights</h2>
                            <a href="{% url 'personality:dashboard' %}" class="text-purple-400 hover:text-purple-300 text-sm">View Full Dashboard</a>
                        </div>
                        
                        <!-- Personality Quick View -->
                        <div x-show="personalityData" class="mb-6">
                            <h3 class="font-medium mb-3">Your Personality Profile</h3>
                            <div class="grid grid-cols-5 gap-2 mb-4">
                                <div class="text-center">
                                    <div class="text-xs text-purple-300">O</div>
                                    <div class="w-full bg-gray-700 rounded-full h-1">
                                        <div class="bg-purple-500 h-1 rounded-full" :style="`width: ${(personalityData.openness || 0) * 100}%`"></div>
                                    </div>
                                    <div class="text-xs text-gray-400" x-text="Math.round((personalityData.openness || 0) * 100) + '%'"></div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xs text-blue-300">C</div>
                                    <div class="w-full bg-gray-700 rounded-full h-1">
                                        <div class="bg-blue-500 h-1 rounded-full" :style="`width: ${(personalityData.conscientiousness || 0) * 100}%`"></div>
                                    </div>
                                    <div class="text-xs text-gray-400" x-text="Math.round((personalityData.conscientiousness || 0) * 100) + '%'"></div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xs text-green-300">E</div>
                                    <div class="w-full bg-gray-700 rounded-full h-1">
                                        <div class="bg-green-500 h-1 rounded-full" :style="`width: ${(personalityData.extraversion || 0) * 100}%`"></div>
                                    </div>
                                    <div class="text-xs text-gray-400" x-text="Math.round((personalityData.extraversion || 0) * 100) + '%'"></div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xs text-yellow-300">A</div>
                                    <div class="w-full bg-gray-700 rounded-full h-1">
                                        <div class="bg-yellow-500 h-1 rounded-full" :style="`width: ${(personalityData.agreeableness || 0) * 100}%`"></div>
                                    </div>
                                    <div class="text-xs text-gray-400" x-text="Math.round((personalityData.agreeableness || 0) * 100) + '%'"></div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xs text-red-300">ES</div>
                                    <div class="w-full bg-gray-700 rounded-full h-1">
                                        <div class="bg-red-500 h-1 rounded-full" :style="`width: ${(1 - (personalityData.neuroticism || 0)) * 100}%`"></div>
                                    </div>
                                    <div class="text-xs text-gray-400" x-text="Math.round((1 - (personalityData.neuroticism || 0)) * 100) + '%'"></div>
                                </div>
                            </div>
                            <div class="text-center">
                                <button @click="window.location.href='{% url 'personality:assessment' %}'" 
                                        class="bg-purple-600 hover:bg-purple-700 px-3 py-1 rounded text-sm transition-colors">
                                    Take New Assessment
                                </button>
                            </div>
                        </div>
                        
                        <!-- No Personality Data -->
                        <div x-show="!personalityData" class="text-center py-4 mb-6">
                            <div class="text-4xl mb-2">📝</div>
                            <h3 class="font-medium mb-2">Discover Your Personality</h3>
                            <p class="text-sm text-gray-400 mb-3">Help NOOR understand you better by taking a personality assessment</p>
                            <button @click="window.location.href='{% url 'personality:assessment' %}'" 
                                    class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded transition-colors">
                                Start Assessment
                            </button>
                        </div>
                        
                        <!-- Dynamic Insights -->
                        <div class="space-y-3 max-h-40 overflow-y-auto">
                            <template x-for="insight in personalityInsights" :key="insight.id">
                                <div class="glass-dark rounded-lg p-3">
                                    <h4 class="font-medium text-sm mb-1" x-text="insight.title"></h4>
                                    <p class="text-xs text-gray-300" x-text="insight.description"></p>
                                </div>
                            </template>
                            
                            <!-- Default insights when no personality data -->
                            <div x-show="personalityInsights.length === 0" class="space-y-3">
                                <div class="glass-dark rounded-lg p-3">
                                    <h4 class="font-medium text-sm mb-1">🌟 Welcome to NOOR</h4>
                                    <p class="text-xs text-gray-300">I'm here to learn about your personality and adapt to help you better!</p>
                                </div>
                                <div class="glass-dark rounded-lg p-3">
                                    <h4 class="font-medium text-sm mb-1">💪 Personal Growth</h4>
                                    <p class="text-xs text-gray-300">Take the personality assessment to unlock personalized insights and recommendations.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Chat Modal -->
    <div x-show="showChat" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div @click.away="closeChat()" 
             class="bg-gray-900/90 backdrop-blur-lg rounded-2xl border border-gray-600/30 w-full max-w-2xl h-96 flex flex-col">
            <!-- Chat Header -->
            <div class="flex items-center justify-between p-4 border-b border-gray-600/30">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-blue-500 flex items-center justify-center">
                        <span x-text="noorExpression"></span>
                    </div>
                    <div>
                        <h3 class="font-semibold">NOOR</h3>
                        <p class="text-sm text-gray-400">Online</p>
                    </div>
                </div>
                <button @click="closeChat()" class="text-gray-400 hover:text-white text-xl">×</button>
            </div>
            
            <!-- Chat Messages -->
            <div class="flex-1 overflow-y-auto p-4 space-y-4">
                <template x-for="message in chatMessages" :key="message.id">
                    <div x-bind:class="message.sender === 'user' ? 'flex justify-end' : 'flex justify-start'">
                        <div x-bind:class="message.sender === 'user' ? 'bg-purple-600 text-white' : 'bg-gray-700 text-gray-100'"
                             class="max-w-xs px-4 py-2 rounded-2xl">
                            <p x-text="message.text" class="text-sm"></p>
                            <p x-text="message.time" class="text-xs opacity-70 mt-1"></p>
                        </div>
                    </div>
                </template>
                
                <!-- Typing Indicator -->
                <div x-show="isNoorTyping" class="flex justify-start">
                    <div class="bg-gray-700 text-gray-100 max-w-xs px-4 py-2 rounded-2xl">
                        <div class="flex space-x-1">
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Chat Input -->
            <div class="p-4 border-t border-gray-600/30">
                <div class="flex space-x-2">
                    <input x-model="chatInput" 
                           @keyup.enter="sendMessage()"
                           type="text" 
                           placeholder="Type a message..."
                           class="flex-1 bg-gray-800/50 border border-gray-600 rounded-xl px-4 py-2 focus:outline-none focus:border-purple-500 text-white placeholder-gray-400">
                    <button @click="sendMessage()" 
                            class="bg-purple-600 hover:bg-purple-700 rounded-xl px-4 py-2 text-white transition-colors">
                        Send
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Search Bar (Fixed) -->
    <div class="fixed bottom-0 left-0 right-0 bg-gray-900/90 backdrop-blur-lg border-t border-gray-700/50 p-3 z-30">
        <div class="container mx-auto max-w-4xl">
            <div class="flex space-x-3">
                <div class="flex-1 relative">
                    <input x-model="searchQuery" 
                           @keyup.enter="processSearch()"
                           type="text" 
                           placeholder="Ask NOOR anything or search for content..."
                           class="w-full bg-gray-800/50 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:border-purple-500 text-white placeholder-gray-400 text-sm">
                    <button @click="processSearch()" 
                            class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-purple-600 hover:bg-purple-700 rounded-md px-3 py-1 text-xs font-medium transition-colors">
                        Search
                    </button>
                </div>
                <button @click="startVoiceInput()" 
                        class="bg-gray-800/50 hover:bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-white transition-colors text-sm">
                    🎤
                </button>
            </div>
            <!-- Quick Suggestions -->
            <div class="flex flex-wrap gap-2 mt-2">
                <button @click="searchQuery = 'play relaxing music'; processSearch()" 
                        class="px-2 py-1 bg-gray-700/50 hover:bg-gray-600/50 rounded-md text-xs transition-colors">🎵 Play Music</button>
                <button @click="searchQuery = 'how are you feeling today?'; processSearch()" 
                        class="px-2 py-1 bg-gray-700/50 hover:bg-gray-600/50 rounded-md text-xs transition-colors">😊 Mood Check</button>
                <button @click="searchQuery = 'suggest a game'; processSearch()" 
                        class="px-2 py-1 bg-gray-700/50 hover:bg-gray-600/50 rounded-md text-xs transition-colors">🎮 Games</button>
                <button @click="openChat()" 
                        class="px-2 py-1 bg-gray-700/50 hover:bg-gray-600/50 rounded-md text-xs transition-colors">💬 Chat</button>
            </div>
        </div>
    </div>
</div>

<script>
function noorApp() {
    return {
        // Display states
        showChat: false,
        showNotifications: false,
        mediaTab: 'music',
        
        // NOOR character
        noorExpression: '😊',
        noorMessage: '',
        isNoorTalking: false,
        userMood: 'Happy',
        
        // Search
        searchQuery: '',
        
        // Personality data
        personalityData: null,
        personalityInsights: [],
        
        // Chat system
        chatMessages: [
            {
                id: 1,
                sender: 'noor',
                text: 'Hello! I\'m NOOR, your adaptive AI companion. How can I help you today?',
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            }
        ],
        chatInput: '',
        isNoorTyping: false,
        
        // Initialize
        async init() {
            this.noorExpression = '😊';
            await this.loadPersonalityData();
            // Add some welcome interactions
            setTimeout(() => {
                this.showWelcomeMessage();
            }, 2000);
        },
        
        // Load personality data
        async loadPersonalityData() {
            try {
                const response = await fetch('{% url "personality:api_insights" %}');
                const data = await response.json();
                
                if (data.success && data.current_assessment) {
                    this.personalityData = data.current_assessment;
                    this.personalityInsights = data.insights || [];
                    this.adaptNoorToPersonality();
                }
            } catch (error) {
                console.log('No personality data available yet');
            }
        },
        
        // Adapt NOOR based on personality
        adaptNoorToPersonality() {
            if (!this.personalityData) return;
            
            // Adapt greeting based on extraversion
            if (this.personalityData.extraversion > 0.7) {
                this.chatMessages[0].text = 'Hey there! I\'m NOOR, and I\'m super excited to meet you! Let\'s chat and have some fun together! 🎉';
            } else if (this.personalityData.extraversion < 0.3) {
                this.chatMessages[0].text = 'Hello, I\'m NOOR. I\'m here whenever you need me, no pressure to chat if you prefer some quiet time. 😌';
            }
            
            // Adapt expression based on openness
            if (this.personalityData.openness > 0.7) {
                this.noorExpression = '🤔';
                this.noorMessage = 'I can sense your creative spirit! ✨';
            }
        },
        
        showWelcomeMessage() {
            this.noorMessage = 'Welcome! Click me to say hi! 👋';
            setTimeout(() => {
                this.noorMessage = '';
            }, 3000);
        },
        
        // NOOR Interactions
        interactWithNoor() {
            const reactions = [
                { expression: '😄', message: 'That tickles! Hehe!' },
                { expression: '🤗', message: 'Virtual hug incoming!' },
                { expression: '😊', message: 'Hi there! How are you?' },
                { expression: '😎', message: 'You\'re awesome!' },
                { expression: '🥰', message: 'You made my day!' },
                { expression: '🎉', message: 'Woohoo! Let\'s have fun!' }
            ];
            
            const reaction = reactions[Math.floor(Math.random() * reactions.length)];
            this.noorExpression = reaction.expression;
            this.noorMessage = reaction.message;
            this.isNoorTalking = true;
            
            setTimeout(() => {
                this.isNoorTalking = false;
                this.noorExpression = '😊';
                this.noorMessage = '';
            }, 3000);
        },
        
        // Media functions
        playMedia(type, item) {
            if (type === 'music') {
                this.noorExpression = '🎵';
                this.noorMessage = `Playing ${item.replace('-', ' ')}! 🎶`;
            } else {
                this.noorExpression = '📺';
                this.noorMessage = `Starting ${item} video! 🎬`;
            }
            
            setTimeout(() => {
                this.noorExpression = '😊';
                this.noorMessage = '';
            }, 3000);
        },
        
        // Game functions
        selectGame(gameId) {
            this.noorExpression = '🎮';
            this.noorMessage = 'Let\'s start this adventure!';
            
            setTimeout(() => {
                window.location.href = `/games/${gameId}/`;
            }, 1500);
        },
        
        // Chat functions
        openChat() {
            this.showChat = true;
        },
        
        closeChat() {
            this.showChat = false;
        },
        
        sendMessage() {
            if (!this.chatInput.trim()) return;
            
            const userMessage = {
                id: Date.now(),
                sender: 'user',
                text: this.chatInput,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            };
            
            this.chatMessages.push(userMessage);
            this.chatInput = '';
            
            // Show typing indicator
            this.isNoorTyping = true;
            
            // Generate NOOR response
            setTimeout(() => {
                this.generateNoorResponse(userMessage.text);
                this.isNoorTyping = false;
            }, 1500);
        },
        
        generateNoorResponse(userText) {
            const text = userText.toLowerCase();
            let response = '';
            let expression = '😊';
            
            // Check for personality keywords first
            if (text.includes('personality') || text.includes('assessment') || text.includes('test')) {
                if (!this.personalityData) {
                    response = 'I\'d love to learn more about your personality! Taking the personality assessment will help me understand you better and adapt my responses. Would you like to start?';
                    expression = '🧠';
                } else {
                    response = 'I can see from your personality profile that you\'re quite unique! Would you like to see your dashboard or take another assessment to track changes?';
                    expression = '📊';
                }
            } else if (text.includes('sad') || text.includes('down') || text.includes('upset')) {
                // Adapt response based on agreeableness and extraversion
                if (this.personalityData?.agreeableness > 0.7) {
                    response = 'I can sense you\'re going through a tough time, and that\'s completely okay. You seem like someone who cares deeply about others - remember to show yourself the same kindness. Would you like some gentle music or breathing exercises?';
                } else {
                    response = 'I\'m sorry you\'re feeling that way. Sometimes processing difficult emotions on your own can be helpful. Would you like some calming music or space to think?';
                }
                expression = '🤗';
            } else if (text.includes('happy') || text.includes('great') || text.includes('good')) {
                // Adapt response based on extraversion
                if (this.personalityData?.extraversion > 0.7) {
                    response = 'That\'s absolutely fantastic! Your positive energy is contagious! I can tell you really know how to embrace the good moments. What\'s got you feeling so great today?';
                    expression = '🎉';
                } else {
                    response = 'That\'s wonderful to hear. I\'m glad you\'re feeling good. Sometimes the quiet moments of happiness are the most meaningful.';
                    expression = '�';
                }
            } else if (text.includes('music') || text.includes('song')) {
                // Suggest music based on openness and extraversion
                let musicSuggestion = 'Check out the media suggestions on the left';
                if (this.personalityData?.openness > 0.7) {
                    musicSuggestion = 'Given your openness to new experiences, you might enjoy exploring some experimental or world music in addition to our regular suggestions';
                } else if (this.personalityData?.extraversion > 0.7) {
                    musicSuggestion = 'I bet you\'d love some upbeat, energetic tracks! Check out our upbeat collection';
                }
                response = `I\'d love to help you find some music! ${musicSuggestion}. What genre matches your mood right now?`;
                expression = '🎵';
            } else if (text.includes('game') || text.includes('play')) {
                // Suggest games based on conscientiousness and openness
                let gameSuggestion = 'I have some great RPG games';
                if (this.personalityData?.conscientiousness > 0.7) {
                    gameSuggestion = 'Given your organized nature, you might really enjoy Personality Quest - it has structured progression and meaningful goals';
                } else if (this.personalityData?.openness > 0.7) {
                    gameSuggestion = 'With your creative mind, Mood Dungeon offers lots of imaginative scenarios and creative problem-solving';
                }
                response = `Games are fantastic for growth! ${gameSuggestion}. Want to try one?`;
                expression = '🎮';
            } else if (text.includes('help') || text.includes('support')) {
                // Tailor support based on personality
                if (this.personalityData?.neuroticism > 0.6) {
                    response = 'I\'m here for you, and I understand that sometimes support is exactly what we need. Let\'s take this one step at a time. I can suggest calming activities, help you organize your thoughts, or just listen.';
                } else {
                    response = 'I\'m here to support you! I can suggest music, guide you through games, help with personal insights, or just chat. What would be most helpful right now?';
                }
                expression = '💪';
            } else {
                // General response adapted to personality
                if (this.personalityData?.openness > 0.7) {
                    response = 'That\'s fascinating! I love how your mind works. Tell me more about that - I\'m here to explore ideas and discover new perspectives with you.';
                    expression = '🤔';
                } else if (this.personalityData?.agreeableness > 0.7) {
                    response = 'That\'s really thoughtful of you to share that. I appreciate our conversation and I\'m here to listen and help however I can.';
                    expression = '�';
                } else {
                    response = 'That\'s interesting! Tell me more about that. I\'m here to listen and help however I can.';
                    expression = '🤔';
                }
            }
            
            const noorMessage = {
                id: Date.now(),
                sender: 'noor',
                text: response,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            };
            
            this.chatMessages.push(noorMessage);
            this.noorExpression = expression;
        },
        
        // Search functions
        processSearch() {
            if (!this.searchQuery.trim()) return;
            
            const query = this.searchQuery.toLowerCase();
            
            if (query.includes('music') || query.includes('song') || query.includes('play')) {
                this.mediaTab = 'music';
                this.noorExpression = '🎵';
                this.noorMessage = 'Here\'s some great music for you!';
            } else if (query.includes('video')) {
                this.mediaTab = 'videos';
                this.noorExpression = '📺';
                this.noorMessage = 'Check out these videos!';
            } else if (query.includes('game')) {
                this.noorExpression = '🎮';
                this.noorMessage = 'Let\'s explore some games!';
            } else if (query.includes('mood') || query.includes('feeling')) {
                this.noorExpression = '😊';
                this.noorMessage = 'How are you feeling today?';
            } else {
                this.openChat();
                this.chatInput = this.searchQuery;
                this.noorExpression = '💬';
                this.noorMessage = 'Let\'s chat about that!';
            }
            
            setTimeout(() => {
                this.noorExpression = '😊';
                this.noorMessage = '';
            }, 3000);
            
            this.searchQuery = '';
        },
        
        // Voice input
        startVoiceInput() {
            if ('webkitSpeechRecognition' in window) {
                const recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onresult = (event) => {
                    this.searchQuery = event.results[0][0].transcript;
                    this.processSearch();
                };
                
                recognition.start();
                this.noorExpression = '🎤';
                this.noorMessage = 'Listening...';
                
                setTimeout(() => {
                    this.noorExpression = '😊';
                    this.noorMessage = '';
                }, 3000);
            } else {
                this.noorMessage = 'Voice input not supported in this browser';
                setTimeout(() => {
                    this.noorMessage = '';
                }, 3000);
            }
        }
    }
}
</script>
{% endblock %}
